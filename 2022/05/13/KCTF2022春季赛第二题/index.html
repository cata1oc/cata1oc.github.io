<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>KCTF2022春季赛第二题 | cataLoc's Blog</title><meta name="description" content="KCTF2022春季赛第二题"><meta name="keywords" content="CTF,Windows逆向"><meta name="author" content="cataLoc"><meta name="copyright" content="cataLoc"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="KCTF2022春季赛第二题"><meta name="twitter:description" content="KCTF2022春季赛第二题"><meta name="twitter:image" content="https://raw.githubusercontent.com/cata1oc/cata1oc.github.io/master/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x5B.jpg"><meta property="og:type" content="article"><meta property="og:title" content="KCTF2022春季赛第二题"><meta property="og:url" content="http://cata1oc.github.io/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/"><meta property="og:site_name" content="cataLoc's Blog"><meta property="og:description" content="KCTF2022春季赛第二题"><meta property="og:image" content="https://raw.githubusercontent.com/cata1oc/cata1oc.github.io/master/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x5B.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'true'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://cata1oc.github.io/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/"><link rel="prev" title="KCTF2022春季赛第三题" href="http://cata1oc.github.io/2022/05/15/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%B8%89%E9%A2%98/"><link rel="next" title="AFL源码分析05：fuzz_one" href="http://cata1oc.github.io/2022/03/12/AFL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9005/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">cataLoc's Blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/Substitute.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">146</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">14</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Catalog</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#前言"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">前言</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#分析流程"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">分析流程</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0x0"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">Part 0x0</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0x1"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">Part 0x1</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0x2"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">Part 0x2</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0x3"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text">Part 0x3</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0x4"><span class="toc_mobile_items-number">2.5.</span> <span class="toc_mobile_items-text">Part 0x4</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0x5"><span class="toc_mobile_items-number">2.6.</span> <span class="toc_mobile_items-text">Part 0x5</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0x6-0x7"><span class="toc_mobile_items-number">2.7.</span> <span class="toc_mobile_items-text">Part 0x6&#x2F;0x7</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0x8"><span class="toc_mobile_items-number">2.8.</span> <span class="toc_mobile_items-text">Part 0x8</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0x9"><span class="toc_mobile_items-number">2.9.</span> <span class="toc_mobile_items-text">Part 0x9</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0xA"><span class="toc_mobile_items-number">2.10.</span> <span class="toc_mobile_items-text">Part 0xA</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0xB"><span class="toc_mobile_items-number">2.11.</span> <span class="toc_mobile_items-text">Part 0xB</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Part-0xC"><span class="toc_mobile_items-number">2.12.</span> <span class="toc_mobile_items-text">Part 0xC</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#完整代码"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">完整代码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#参考链接："><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">参考链接：</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分析流程"><span class="toc-number">2.</span> <span class="toc-text">分析流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0x0"><span class="toc-number">2.1.</span> <span class="toc-text">Part 0x0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0x1"><span class="toc-number">2.2.</span> <span class="toc-text">Part 0x1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0x2"><span class="toc-number">2.3.</span> <span class="toc-text">Part 0x2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0x3"><span class="toc-number">2.4.</span> <span class="toc-text">Part 0x3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0x4"><span class="toc-number">2.5.</span> <span class="toc-text">Part 0x4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0x5"><span class="toc-number">2.6.</span> <span class="toc-text">Part 0x5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0x6-0x7"><span class="toc-number">2.7.</span> <span class="toc-text">Part 0x6&#x2F;0x7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0x8"><span class="toc-number">2.8.</span> <span class="toc-text">Part 0x8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0x9"><span class="toc-number">2.9.</span> <span class="toc-text">Part 0x9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0xA"><span class="toc-number">2.10.</span> <span class="toc-text">Part 0xA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0xB"><span class="toc-number">2.11.</span> <span class="toc-text">Part 0xB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Part-0xC"><span class="toc-number">2.12.</span> <span class="toc-text">Part 0xC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#完整代码"><span class="toc-number">3.</span> <span class="toc-text">完整代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考链接："><span class="toc-number">4.</span> <span class="toc-text">参考链接：</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://raw.githubusercontent.com/cata1oc/cata1oc.github.io/master/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x5B.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">KCTF2022春季赛第二题</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> Created 2022-05-13<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> Updated 2022-05-20</time><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>Post View:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>2022春季赛的第二题，成功在规定时间内完成，写完wp后首发在<a href="https://bbs.pediy.com/thread-272766.htm" target="_blank" rel="noopener">看雪论坛</a>，还混到了一个优秀，现在补档到博客里。</p>
<h2 id="分析流程"><a href="#分析流程" class="headerlink" title="分析流程"></a>分析流程</h2><h3 id="Part-0x0"><a href="#Part-0x0" class="headerlink" title="Part 0x0"></a>Part 0x0</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x0.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x0.png"></a>

<ol>
<li>sub_40100C用来显示文本内容</li>
<li>sub_40103A用来读取输入字符串</li>
<li>IDA分析出的 v9 >= 0，这里的v9是单字节有符号数，因此实际运算时表现为 v9 <= 0x80（用C写wp就没这么多事了）</li>
<li>部分操作是单字节运算，因此运算过后，与上0xFF</li>
<li>最终得到一个单字节的数，保存在v72中，后面会用到</li>
</ol>
<h3 id="Part-0x1"><a href="#Part-0x1" class="headerlink" title="Part 0x1"></a>Part 0x1</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x1.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x1.png"></a>

<ol>
<li>这部分是一个单走的函数sub_40106C，它用来在指定地址初始化一个大小为4096字节的缓冲区，里面包含了1024个生成的随机数</li>
<li>这里需要注意的是右移运算，实际用的是算术右移，因此需要注意判断操作数的正负情况，来进行对应的补符号位</li>
</ol>
<h3 id="Part-0x2"><a href="#Part-0x2" class="headerlink" title="Part 0x2"></a>Part 0x2</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x2.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x2.png"></a>

<ol>
<li>这里是对输入的字符串进行一个运算，还是算术右移需要注意，由于是右移8位，对于负数右移需要或上0xFF000000</li>
<li>这里会计算出一个值，并最终赋给变量v67，这个v67在最后一关前会进行判断，如果v67的值为0xf52e0765，则能成功闯关，得到唯一解</li>
</ol>
<h3 id="Part-0x3"><a href="#Part-0x3" class="headerlink" title="Part 0x3"></a>Part 0x3</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x3.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x3.png"></a>

<ol>
<li>这是一个操作字符串的函数，直接F5即可。减法运算需要注意只保留单字节结果</li>
</ol>
<h3 id="Part-0x4"><a href="#Part-0x4" class="headerlink" title="Part 0x4"></a>Part 0x4</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x4.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x4.png"></a>

<ol>
<li>这部分在栈中生成一个长度为200的数组，变量v66指向首地址</li>
<li>在Part 0x0中计算出来的值会赋值给变量v72，这里会将v72进行符号扩展后，赋值给变量v13（见红框）</li>
<li>在运算时，乘法运算依旧是带符号的，所以需要分情况讨论一下（见橙框）</li>
</ol>
<h3 id="Part-0x5"><a href="#Part-0x5" class="headerlink" title="Part 0x5"></a>Part 0x5</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x5.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x5.png"></a>

<ol>
<li>这里是一个判断，要求字符串前3个数异或后的结果，并与v66数组中靠后的3个数进行比较，若相同，才能进入下一关</li>
<li>经过测试，如果v72的值（在Part 0x0计算出）的小于0x80，即为正的情况下，那么v66中3个数的值异或的结果一定为0x7；否则将是一个接近-1（0xFFFFFFFF）的大数。</li>
<li>字符串输入的字符只能在（0-9a-zA-Z）中取，因此只要保证在v72小于0x80的情况下，凑出一个异或结果为0x7的数即可，这里我们选择”007”，刚好可以过掉这一关</li>
</ol>
<h3 id="Part-0x6-0x7"><a href="#Part-0x6-0x7" class="headerlink" title="Part 0x6/0x7"></a>Part 0x6/0x7</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x6.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x6.png"></a>

<ol>
<li>这部分判断字符串的第4~7位，这里的字符串是在Part 0x3中经过处理后的字符串的值。这里只要简单凑一下，就可以得到这4个字符为”KCTF”</li>
<li>这里是v74[0]实际指向的，Arglist[6]的位置，可以通过汇编得出</li>
</ol>
<h3 id="Part-0x8"><a href="#Part-0x8" class="headerlink" title="Part 0x8"></a>Part 0x8</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x8.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x8.png"></a>

<ol>
<li>这部分运算直接F5就可以，这里只对最后9位字符串进行判断，要求这4位字符串依次读取，按照此算法，均可被整除</li>
<li>此时还无法得到正确的字符串序列（图中为了演示此算法已给出），需要放到后面去计算</li>
</ol>
<h3 id="Part-0x9"><a href="#Part-0x9" class="headerlink" title="Part 0x9"></a>Part 0x9</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x9.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x9.png"></a>

<ol>
<li>这是一个简单的排序算法，负责将后9位数按照大小进行排序</li>
</ol>
<h3 id="Part-0xA"><a href="#Part-0xA" class="headerlink" title="Part 0xA"></a>Part 0xA</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0xA.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0xA.png"></a>

<ol>
<li>这里会调用sub_4010B7，来操纵一个内置的字符串，然后将<strong>排序后</strong>的字符串后9位与进行操作后的字符串中的前9位依次进行比较，若相同才可进入之后的判断</li>
<li>可以发现，这里表明了，后9位字符串的取值正是”123456789”以某一种顺序排列后的结果</li>
</ol>
<h3 id="Part-0xB"><a href="#Part-0xB" class="headerlink" title="Part 0xB"></a>Part 0xB</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0xB.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0xB.png"></a>

<ol>
<li>这里做一个简单的fuzz，找到后9位数的排列顺序，以满足（除了v67的值等于0xf52e0765）外的所有条件</li>
<li>最终可以找到一个字符串”381654729”</li>
</ol>
<h3 id="Part-0xC"><a href="#Part-0xC" class="headerlink" title="Part 0xC"></a>Part 0xC</h3><a href="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0xC.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0xC.png"></a> 

<ol>
<li>此时只差前3位字符串的值未确定了，还是一样，通过一个fuzz，遍历(000~ZZZ)的所有情况，找到符合要求的前3位（3个字符异或结果为7，这个条件也可以加上）</li>
<li>最终得到字符串”421”</li>
<li>拼接起来就是”421KCTF381654729”</li>
</ol>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(s)</span>:</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># Part 0x0</span></span><br><span class="line">	v70 = <span class="number">0</span></span><br><span class="line">	v4 = len(s)</span><br><span class="line">	v5 = <span class="number">0</span></span><br><span class="line">	v71 = v4</span><br><span class="line">	v6 = v4</span><br><span class="line">	v72 = <span class="number">0</span></span><br><span class="line">	<span class="keyword">if</span> v4 != <span class="number">0</span>:</span><br><span class="line">		v7 = s</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(v6):</span><br><span class="line">			v5 = ord(v7[i]) ^ v5</span><br><span class="line">			v5 = v5 & <span class="number">0xFF</span></span><br><span class="line">			v8 = <span class="number">8</span></span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">				v9 = <span class="number">2</span> * v5</span><br><span class="line">				v9 = v9 & <span class="number">0xFF</span></span><br><span class="line">				v10 = v9 ^ <span class="number">7</span></span><br><span class="line">				<span class="keyword">if</span> v9 < <span class="number">0x80</span>:</span><br><span class="line">					v10 = v9</span><br><span class="line">				v5 = v10</span><br><span class="line">		v4 = v71</span><br><span class="line">		v72 = v10</span><br><span class="line">		print(<span class="string">'Part 0x0 Calculate v72 For Part 0x4: '</span>, hex(v72))</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># Part 0x1</span></span><br><span class="line">	list_5B20 = sub_40106C()</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> list_5B20:</span><br><span class="line">		<span class="comment">#print(hex(x))</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	<span class="comment"># Part 0x2</span></span><br><span class="line">	v11 = <span class="number">0xFFFFFFFF</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(v4):</span><br><span class="line">		tmp = list_5B20[<span class="number">0xFF</span> & (v11 ^ ord(s[i]))]</span><br><span class="line">		<span class="keyword">if</span> v11 >= <span class="number">0x80000000</span>:</span><br><span class="line">			v11 = ((v11 >> <span class="number">8</span>) | <span class="number">0xFF000000</span>) ^ tmp</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			v11 = (v11 >> <span class="number">8</span>) ^ tmp</span><br><span class="line">	v67 = v11 ^ <span class="number">0xFFFFFFFF</span>	</span><br><span class="line">	print(<span class="string">'Part 0x2, This Value Should Be 0xF52E0765: '</span>, hex(v67))</span><br><span class="line">	<span class="keyword">if</span> v67 == <span class="number">0xf52e0765</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># Part 0x3</span></span><br><span class="line">	s = sub_4010B7(s, v4)</span><br><span class="line">	print(<span class="string">'Part 0x3 Manipulat Original String, Used For Xor: '</span>, s)</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># Part 0x4</span></span><br><span class="line">	v13 = v72</span><br><span class="line">	v69 = <span class="number">1</span></span><br><span class="line">	v14 = v72 + <span class="number">1</span></span><br><span class="line">	v66 = []</span><br><span class="line">	<span class="keyword">while</span>(v13 < v14):</span><br><span class="line">		<span class="keyword">if</span> v13 > <span class="number">0x80</span>:</span><br><span class="line">			v15 = <span class="number">0xFFFFFF00</span> | v13</span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">200</span>):</span><br><span class="line">				<span class="keyword">if</span> (v15 & <span class="number">1</span>) != <span class="number">0</span>:</span><br><span class="line">					v15_abs = <span class="number">0xFFFFFFFF</span> - v15 + <span class="number">1</span></span><br><span class="line">					v15_abs = <span class="number">3</span> * v15_abs - <span class="number">1</span></span><br><span class="line">					v15 = <span class="number">0xFFFFFFFF</span> - (v15_abs - <span class="number">1</span>)</span><br><span class="line">					</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					<span class="keyword">if</span> v15 > <span class="number">0x80000000</span>:</span><br><span class="line">						v15 = (v15 >> <span class="number">1</span>) | <span class="number">0x80000000</span></span><br><span class="line">					<span class="keyword">else</span>:</span><br><span class="line">						v15 = v15 >> <span class="number">1</span></span><br><span class="line">				v66.append(hex(v15))</span><br><span class="line">				<span class="comment">#print(j, ' ', hex(v15))</span></span><br><span class="line">			</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			v15 = v13 & <span class="number">0xFF</span></span><br><span class="line">			<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">200</span>):</span><br><span class="line">				<span class="keyword">if</span> (v15 & <span class="number">1</span>) != <span class="number">0</span>:</span><br><span class="line">					v15 = <span class="number">3</span> * v15 + <span class="number">1</span></span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					<span class="keyword">if</span> v15 > <span class="number">0x80000000</span>:</span><br><span class="line">						v15 = (v15 >> <span class="number">1</span>) | <span class="number">0x80000000</span></span><br><span class="line">					<span class="keyword">else</span>:</span><br><span class="line">						v15 = v15 >> <span class="number">1</span></span><br><span class="line">				v66.append((v15))</span><br><span class="line">				<span class="comment">#print(j, ' ', hex(v15))</span></span><br><span class="line">		v13 = v13 + <span class="number">1</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	<span class="comment"># Part 0x5</span></span><br><span class="line">	<span class="keyword">if</span> v72 < <span class="number">0x80</span>:</span><br><span class="line">		print(<span class="string">'Part 0x5, Calculate With Or: '</span>, (v66[<span class="number">195</span>]), (v66[<span class="number">196</span>]), (v66[<span class="number">197</span>]))</span><br><span class="line">		v17 = (v66[<span class="number">195</span>]) | (v66[<span class="number">196</span>]) | (v66[<span class="number">197</span>])</span><br><span class="line">		v18 = v71</span><br><span class="line">		cmp_a = (s[<span class="number">0</span>])^(s[<span class="number">1</span>])^(s[<span class="number">2</span>])</span><br><span class="line">		print(<span class="string">'Part 0x5, Or Result: '</span>, hex(v17))</span><br><span class="line">		print(<span class="string">'Part 0x5, Xor Result: '</span>, hex(cmp_a))</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		print(<span class="string">'Part 0x5, Calculate With Or: '</span>, hex(int(v66[<span class="number">195</span>], <span class="number">16</span>)), hex(int(v66[<span class="number">196</span>], <span class="number">16</span>)), hex(int(v66[<span class="number">197</span>], <span class="number">16</span>)))</span><br><span class="line">		v17 = int(v66[<span class="number">195</span>], <span class="number">16</span>) | int(v66[<span class="number">196</span>], <span class="number">16</span>) | int(v66[<span class="number">197</span>], <span class="number">16</span>)</span><br><span class="line">		v18 = v71</span><br><span class="line">		cmp_a = (s[<span class="number">0</span>])^(s[<span class="number">1</span>])^(s[<span class="number">2</span>])</span><br><span class="line">		print(<span class="string">'Part 0x5, Or Result: '</span>, hex(v17))</span><br><span class="line">		print(<span class="string">'Part 0x5, Xor Result: '</span>, hex(cmp_a))</span><br><span class="line">	</span><br><span class="line">		</span><br><span class="line">	<span class="comment"># Part 0x6</span></span><br><span class="line">	v19 = v17 + <span class="number">2</span></span><br><span class="line">	v20 = v18 - v19 - <span class="number">7</span></span><br><span class="line">	print(<span class="string">'Part 0x6, This Value Should Be Less Than Or Equal 0: '</span> , v20)</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># Part 0x7 ['007KCTF' can pass here]</span></span><br><span class="line">	print(<span class="string">'Part 0x7, s[3] should be 0x14/20: '</span>, s[<span class="number">3</span>])</span><br><span class="line">	print(<span class="string">'Part 0x7, s[4] should be 0xC/12: '</span>, s[<span class="number">4</span>])</span><br><span class="line">	print(<span class="string">'Part 0x7, s[5] should be 0x1D/29: '</span>, s[<span class="number">5</span>])</span><br><span class="line">	print(<span class="string">'Part 0x7, s[5] should be 0xF/15: '</span>, s[<span class="number">6</span>])</span><br><span class="line">	</span><br><span class="line">	 </span><br><span class="line">	</span><br><span class="line">	<span class="comment"># Part 0x8</span></span><br><span class="line">	<span class="comment"># v69 = 1, define in Part 0x4</span></span><br><span class="line">	<span class="comment"># v74[0] == s[6]</span></span><br><span class="line">	<span class="comment"># v74[1] ~ v74[</span></span><br><span class="line">	<span class="comment"># v19, Rest Length Of String</span></span><br><span class="line">	<span class="comment"># v70 = 0, define in Part 0x0</span></span><br><span class="line">	</span><br><span class="line">	v74 = s[<span class="number">6</span>:]</span><br><span class="line">	print(<span class="string">'Part 0x8, Rest Length Of String: '</span>, v19)</span><br><span class="line">	v21 = <span class="number">0</span></span><br><span class="line">	v71 = <span class="number">0</span></span><br><span class="line">	<span class="keyword">if</span> v19 > <span class="number">0</span>:</span><br><span class="line">		v22 = <span class="number">1</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(v19):</span><br><span class="line">			v23 = v74[v22] + <span class="number">10</span> * v70</span><br><span class="line">			print(<span class="string">'Part 0x8, ('</span> ,v23, <span class="string">'='</span>, v74[v22], <span class="string">'+'</span>, <span class="string">'10 *'</span>, v70, <span class="string">')%'</span>, v69, <span class="string">'=='</span>, v23%v69)</span><br><span class="line">			v24 = v23 - <span class="number">0x37373737</span></span><br><span class="line">			<span class="keyword">if</span> v23 <= <span class="number">0x4B435445</span>:</span><br><span class="line">				v24 = v23</span><br><span class="line">			v70 = v24</span><br><span class="line">			<span class="keyword">if</span> (v24 % v69):</span><br><span class="line">				print(<span class="string">'Failed! '</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">				<span class="comment">#break</span></span><br><span class="line">			v69 = v69 + <span class="number">1</span></span><br><span class="line">			v22 = v69</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># Part 0x9  Just A Sort</span></span><br><span class="line">	v25 = v19 - <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> (v19 - <span class="number">1</span>) > <span class="number">0</span>:</span><br><span class="line">		v26 = v19 - <span class="number">1</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(v26):</span><br><span class="line">			v27 = <span class="number">0</span></span><br><span class="line">			<span class="keyword">if</span> v25 > <span class="number">0</span>:</span><br><span class="line">				<span class="keyword">for</span> i <span class="keyword">in</span> range(v25):</span><br><span class="line">					v28 = v74[v27 + <span class="number">1</span>]</span><br><span class="line">					v29 = v74[v27 + <span class="number">2</span>]</span><br><span class="line">					<span class="keyword">if</span> v28 > v29:</span><br><span class="line">						v74[v27 + <span class="number">1</span>] = v29</span><br><span class="line">						v74[v27 + <span class="number">2</span>] = v28</span><br><span class="line">					v27 = v27 + <span class="number">1</span></span><br><span class="line">			v25 = v25 - <span class="number">1</span></span><br><span class="line">	print(<span class="string">'Part 0x9, Last 9 Elements After Sort: '</span>, v74[<span class="number">1</span>:])</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># Part 0xA</span></span><br><span class="line">	a_str = <span class="string">'1234567890_ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span></span><br><span class="line">	a_str = sub_4010B7(a_str, v19)</span><br><span class="line">	print(<span class="string">'Part 0xA, a_str: '</span>, a_str)</span><br><span class="line">	v30 = <span class="number">0</span></span><br><span class="line">	<span class="keyword">if</span> v19 > <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(v19):</span><br><span class="line">			print(<span class="string">'Part 0xA, Compare 2: '</span>, a_str[v30], v74[v30+<span class="number">1</span>])</span><br><span class="line">			<span class="keyword">if</span> a_str[v30] != v74[v30+<span class="number">1</span>]:</span><br><span class="line">				print(<span class="string">'Failed!'</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">			v30 = v30 + <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub_4010B7</span><span class="params">(s, length)</span>:</span></span><br><span class="line">	</span><br><span class="line">	res = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">		v4 = ord(s[i])</span><br><span class="line">		v5 = <span class="number">48</span></span><br><span class="line">		<span class="keyword">if</span> v4 >= <span class="number">58</span>:</span><br><span class="line">			v5 = <span class="number">55</span></span><br><span class="line">		res.append((v4 - v5) & <span class="number">0xFF</span>) </span><br><span class="line">		<span class="comment">#res.append(chr((v4 - v5) & 0xFF))</span></span><br><span class="line">	<span class="comment">#print(''.join(res))</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub_40106C</span><span class="params">()</span>:</span></span><br><span class="line">	</span><br><span class="line">	v1 = []</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1024</span>):</span><br><span class="line">		v2 = i</span><br><span class="line">		v3 = <span class="number">8</span></span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">			<span class="keyword">if</span> (v2 & <span class="number">1</span>) != <span class="number">0</span>:</span><br><span class="line">				tmp = <span class="number">0xEDB88320</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				tmp = <span class="number">0</span></span><br><span class="line">			<span class="keyword">if</span> v2 >= <span class="number">0x80000000</span>:</span><br><span class="line">				v2 = ((v2 >> <span class="number">1</span>) | <span class="number">0x80000000</span>) ^ tmp</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				v2 = (v2 >> <span class="number">1</span>) ^ tmp</span><br><span class="line">			<span class="comment">#print(hex(v2))</span></span><br><span class="line">		v1.append(v2)</span><br><span class="line">	v1.append(<span class="number">1</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> v1</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">	s = <span class="string">'A7AKCTF381654729'</span></span><br><span class="line">	res = func(s)</span><br><span class="line">	<span class="string">'''</span></span><br><span class="line"><span class="string">	# Fuzz One For Last 9 Bytes</span></span><br><span class="line"><span class="string">	prefix = 'A7AKCTF'</span></span><br><span class="line"><span class="string">	maybe_result = []</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	example = '123456789'</span></span><br><span class="line"><span class="string">	result = itertools.permutations(example)</span></span><br><span class="line"><span class="string">	for x in result:</span></span><br><span class="line"><span class="string">		suffix = ''.join(x)</span></span><br><span class="line"><span class="string">		s = prefix + suffix</span></span><br><span class="line"><span class="string">		#print(s)</span></span><br><span class="line"><span class="string">		res = func(s)</span></span><br><span class="line"><span class="string">		if res == 1:</span></span><br><span class="line"><span class="string">			print(res, s)</span></span><br><span class="line"><span class="string">			break</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	print(maybe_result)</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line">	</span><br><span class="line">	<span class="string">'''</span></span><br><span class="line"><span class="string">	# Fuzz Two For First 3 Bytes</span></span><br><span class="line"><span class="string">	suffix = 'KCTF381654729'</span></span><br><span class="line"><span class="string">	text = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVMXYZ'</span></span><br><span class="line"><span class="string">	result = itertools.permutations(text, 3)</span></span><br><span class="line"><span class="string">	for x in result:</span></span><br><span class="line"><span class="string">		prefix = ''.join(x)</span></span><br><span class="line"><span class="string">		s = prefix + suffix</span></span><br><span class="line"><span class="string">		#print(s)</span></span><br><span class="line"><span class="string">		res = func(s)</span></span><br><span class="line"><span class="string">		if res == 1:</span></span><br><span class="line"><span class="string">			print(res, s)</span></span><br><span class="line"><span class="string">			break</span></span><br><span class="line"><span class="string">	'''</span></span><br></pre></td></tr></tbody></table></figure></div>



<h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><ol>
<li><a href="https://www.jianshu.com/p/44344593cdaa" target="_blank" rel="noopener">简书：用Python进行排列组合</a></li>
<li><a href="https://blog.csdn.net/weixin_35541666/article/details/111963770" target="_blank" rel="noopener">CSDN：Python使用itertools模块实现排列组合</a></li>
<li><a href="https://blog.csdn.net/swordmanwk/article/details/41598555" target="_blank" rel="noopener">CSDN：32位汇编语言学习笔记(11)–条件传送指令</a></li>
</ol>
</body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">cataLoc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://cata1oc.github.io/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/">http://cata1oc.github.io/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF    </a><a class="post-meta__tags" href="/tags/Windows%E9%80%86%E5%90%91/">Windows逆向    </a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/cata1oc/cata1oc.github.io/master/2022/05/13/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%BA%8C%E9%A2%98/0x5B.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2022/05/15/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%B8%89%E9%A2%98/"><img class="prev_cover lazyload" data-src="https://raw.githubusercontent.com/cata1oc/cata1oc.github.io/master/2022/05/15/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%B8%89%E9%A2%98/0x5C.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Previous Post</div><div class="prev_info"><span>KCTF2022春季赛第三题</span></div></a></div><div class="next-post pull_right"><a href="/2022/03/12/AFL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9005/"><img class="next_cover lazyload" data-src="https://raw.githubusercontent.com/cata1oc/cata1oc.github.io/master/2022/03/12/AFL%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9005/cover0x54.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>AFL源码分析05：fuzz_one</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/10/22/KCTF题库-异想天开/" title="KCTF题库：异想天开"><img class="relatedPosts_cover lazyload"data-src="https://raw.githubusercontent.com/cata1oc/cata1oc.github.io/master/2021/10/22/KCTF%E9%A2%98%E5%BA%93-%E5%BC%82%E6%83%B3%E5%A4%A9%E5%BC%80/cover0x4B.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-10-22</div><div class="relatedPosts_title">KCTF题库：异想天开</div></div></a></div><div class="relatedPosts_item"><a href="/2022/05/15/KCTF2022春季赛第三题/" title="KCTF2022春季赛第三题"><img class="relatedPosts_cover lazyload"data-src="https://raw.githubusercontent.com/cata1oc/cata1oc.github.io/master/2022/05/15/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%B8%89%E9%A2%98/0x5C.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-05-15</div><div class="relatedPosts_title">KCTF2022春季赛第三题</div></div></a></div><div class="relatedPosts_item"><a href="/2022/05/24/KCTF2022春季赛第七题/" title="KCTF2022春季赛第七题"><img class="relatedPosts_cover lazyload"data-src="https://raw.githubusercontent.com/cata1oc/cata1oc.github.io/master/2022/05/24/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%B8%83%E9%A2%98/0x5D.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-05-24</div><div class="relatedPosts_title">KCTF2022春季赛第七题</div></div></a></div><div class="relatedPosts_item"><a href="/2022/06/03/KCTF2022春季赛第九题/" title="KCTF2022春季赛第九题"><img class="relatedPosts_cover lazyload"data-src="https://raw.githubusercontent.com/cata1oc/cata1oc.github.io/master/2022/06/03/KCTF2022%E6%98%A5%E5%AD%A3%E8%B5%9B%E7%AC%AC%E4%B9%9D%E9%A2%98/0x5E.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2022-06-03</div><div class="relatedPosts_title">KCTF2022春季赛第九题</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/12/一次简单的Hook-下/" title="一次简单的Hook（下）"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-12</div><div class="relatedPosts_title">一次简单的Hook（下）</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/10/一次简单的Hook-上/" title="一次简单的Hook（上）"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-10</div><div class="relatedPosts_title">一次简单的Hook（上）</div></div></a></div></div><div class="clear_both"></div></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2022 By cataLoc</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>