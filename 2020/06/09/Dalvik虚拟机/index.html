<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Dalvik虚拟机 | cataLoc's Blog</title><meta name="description" content="Dalvik虚拟机"><meta name="keywords" content="Android逆向"><meta name="author" content="cataLoc"><meta name="copyright" content="cataLoc"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/blog/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Dalvik虚拟机"><meta name="twitter:description" content="Dalvik虚拟机"><meta name="twitter:image" content="https://gitee.com/cataloc/blog/raw/master/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/cover0xB.png"><meta property="og:type" content="article"><meta property="og:title" content="Dalvik虚拟机"><meta property="og:url" content="http://cataloc.gitee.io/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/"><meta property="og:site_name" content="cataLoc's Blog"><meta property="og:description" content="Dalvik虚拟机"><meta property="og:image" content="https://gitee.com/cataloc/blog/raw/master/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/cover0xB.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'true'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/blog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://cataloc.gitee.io/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/"><link rel="prev" title="网络安全基础03(上)：批处理与病毒" href="http://cataloc.gitee.io/blog/2020/06/15/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%8003-%E4%B8%8A-%E6%89%B9%E5%A4%84%E7%90%86%E4%B8%8E%E7%97%85%E6%AF%92/"><link rel="next" title="备用APC队列" href="http://cataloc.gitee.io/blog/2020/06/04/%E5%A4%87%E7%94%A8APC%E9%98%9F%E5%88%97/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/blog/">cataLoc's Blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/blog/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/blog/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/blog/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/blog/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/blog/img/Substitute.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/blog/archives/"><div class="headline">Articles</div><div class="length_num">115</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/blog/tags/"><div class="headline">Tags</div><div class="length_num">7</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/blog/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/blog/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/blog/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/blog/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Catalog</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#前言"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">前言</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#关于Dalvik虚拟机"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">关于Dalvik虚拟机</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Dalvik虚拟机的特点"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">Dalvik虚拟机的特点</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Dalvik虚拟机与Java虚拟机的区别"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">Dalvik虚拟机与Java虚拟机的区别</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#运行的字节码不同"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">运行的字节码不同</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Dalvik可执行文件的体积更小"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">Dalvik可执行文件的体积更小</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#虚拟机架构不同"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text">虚拟机架构不同</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Java程序"><span class="toc_mobile_items-number">4.3.1.</span> <span class="toc_mobile_items-text">Java程序</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Java字节码的foo-函数部分"><span class="toc_mobile_items-number">4.3.2.</span> <span class="toc_mobile_items-text">Java字节码的foo()函数部分</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Dalvik字节码的foo-函数部分"><span class="toc_mobile_items-number">4.3.3.</span> <span class="toc_mobile_items-text">Dalvik字节码的foo()函数部分</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Dalvik虚拟机的执行流程"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">Dalvik虚拟机的执行流程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Dalvik虚拟机的执行方式"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text">Dalvik虚拟机的执行方式</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#参考资料"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text">参考资料</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于Dalvik虚拟机"><span class="toc-number">2.</span> <span class="toc-text">关于Dalvik虚拟机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dalvik虚拟机的特点"><span class="toc-number">3.</span> <span class="toc-text">Dalvik虚拟机的特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dalvik虚拟机与Java虚拟机的区别"><span class="toc-number">4.</span> <span class="toc-text">Dalvik虚拟机与Java虚拟机的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#运行的字节码不同"><span class="toc-number">4.1.</span> <span class="toc-text">运行的字节码不同</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dalvik可执行文件的体积更小"><span class="toc-number">4.2.</span> <span class="toc-text">Dalvik可执行文件的体积更小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#虚拟机架构不同"><span class="toc-number">4.3.</span> <span class="toc-text">虚拟机架构不同</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Java程序"><span class="toc-number">4.3.1.</span> <span class="toc-text">Java程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Java字节码的foo-函数部分"><span class="toc-number">4.3.2.</span> <span class="toc-text">Java字节码的foo()函数部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dalvik字节码的foo-函数部分"><span class="toc-number">4.3.3.</span> <span class="toc-text">Dalvik字节码的foo()函数部分</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dalvik虚拟机的执行流程"><span class="toc-number">5.</span> <span class="toc-text">Dalvik虚拟机的执行流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dalvik虚拟机的执行方式"><span class="toc-number">6.</span> <span class="toc-text">Dalvik虚拟机的执行方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">7.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://gitee.com/cataloc/blog/raw/master/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/cover0xB.png)"><div id="post-info"><div id="post-title"><div class="posttitle">Dalvik虚拟机</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> Created 2020-06-09<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> Updated 2020-06-12</time><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>Post View:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>想要去逆向分析一个程序，那就得了解它所在平台底层的知识，学习如何分析Android程序的之前，了解Dalvik虚拟机是必不可少的环节。本篇就Android运行依赖的<strong>Dalvik虚拟机</strong>（尽管现在都是ART虚拟机了，但Dalvik虚拟机仍有学习的价值，就像学习Windows内核，不都是从xp开始的嘛）作简单的介绍，下一篇会介绍Dalvik语言基础，为之后学习Dalvik指令打下基础。</p>
<h2 id="关于Dalvik虚拟机"><a href="#关于Dalvik虚拟机" class="headerlink" title="关于Dalvik虚拟机"></a>关于Dalvik虚拟机</h2><p><strong>Android系统的应用层是采用Java开发的（Java是主流，现Google全面推行Kotlin）</strong>，由于Java语言的跨平台特性，所以Java的代码必须运行在虚拟机中。正因为这个特性，Android系统也实现了自己的一个类似JVM但是更适合嵌入式平台的虚拟机——Dalvik。Dalvik的功能等同于JVM，为Android平台上的Java代码提供了运行环境。</p>
<h2 id="Dalvik虚拟机的特点"><a href="#Dalvik虚拟机的特点" class="headerlink" title="Dalvik虚拟机的特点"></a>Dalvik虚拟机的特点</h2><ul>
<li>体积小，占用内存空间少（与JVM相比）</li>
<li>专有的DEX（Dalvik Executable）可执行文件格式，体积小，执行速度快（与.class相比）</li>
<li>基于寄存器架构，同时拥有一套完整的指令系统（JVM基于栈架构）</li>
<li>所有的Android程序都运行在Android系统进程中，每个进程都与一个Dalvik虚拟机实例对应。（基于Zygote）</li>
</ul>
<h2 id="Dalvik虚拟机与Java虚拟机的区别"><a href="#Dalvik虚拟机与Java虚拟机的区别" class="headerlink" title="Dalvik虚拟机与Java虚拟机的区别"></a>Dalvik虚拟机与Java虚拟机的区别</h2><p>DVM与传统的JVM有诸多显著区别，具体如下（二者亦不兼容）</p>
<h3 id="运行的字节码不同"><a href="#运行的字节码不同" class="headerlink" title="运行的字节码不同"></a>运行的字节码不同</h3><p>JVM：运行Java字节码（<strong>.java文件 -> .class文件(保存Java字节码)</strong>）</p>
<p>DVM：运行Dalvik字节码（<strong>.class -> .dex(保存Dalvik字节码)</strong>）</p>
<h3 id="Dalvik可执行文件的体积更小"><a href="#Dalvik可执行文件的体积更小" class="headerlink" title="Dalvik可执行文件的体积更小"></a>Dalvik可执行文件的体积更小</h3><p>一般来说，一个Java的应用程序会打包成jar的形式发布在相应平台。一个jar会包含若干个.class文件；Android的应用程序则会把一个.dex文件打包成.apk文件，并且一个.apk文件中仅包含一个.dex文件。而.dex文件又都是由.class文件转换而来的（<strong>由Android SDK提供的”dx”工具完成转换的工作</strong>）。从描述上看，似乎.dex文件比.class文件更紧凑。下面来看一张图：</p>
<a href="/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/jarvsapk.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/jarvsapk.png"></a>

<p>这张图充分说明了为什么Dalvik可执行文件的体积更小。Java类文件中通常有多个方法签名，如果其它类文件引用了该类文件中的方法，相应的方法签名也会被复制到其它类文件中。也就是说，<strong>如果多个不同的类同时包含相同的方法签名，则大量的字符串常量会被多个类文件重复使用</strong>。这些冗余信息造成了文件体积增大，严重影响了虚拟机解析文件的效率。</p>
<p>相反，dx在对Java文件转换为DEX文件时，对所有的Java类文件中的常量池进行了分解，并重新组合成<strong>一个</strong>常量池，让所有类文件共享这个常量池，这也使得DEX文件体积要小很多。</p>
<h3 id="虚拟机架构不同"><a href="#虚拟机架构不同" class="headerlink" title="虚拟机架构不同"></a>虚拟机架构不同</h3><p>在前面说到特点时，就提到<strong>DVM是基于寄存器架构的</strong>，而<strong>JVM是基于栈架构的</strong>。仅从架构上来看，DVM就已经优势无限大，栈是位于内存中的，这就意味着当Java程序运行时，不断对栈的读写操作会进行大量内存访问，会耗费大量CPU时间。这对于资源有限的设备（手机）来说，无疑是笔巨大的开销。相比之下，寄存器的读取要快许多。</p>
<p>书中用一个程序举例，对比分析了<strong>Java字节码与Dalvik字节码的差异</strong>，由于我在本机上实验时，dx工具不能够支持，换了旧版本的build-tools同样不得行（找不出原因了）。所以这里就不给出文件转换的教程了，具体的文件转换步骤可以参考<a href="https://blog.csdn.net/zzc901205/article/details/77676330" target="_blank" rel="noopener">该文章</a>。下面来看程序。</p>
<h4 id="Java程序"><a href="#Java程序" class="headerlink" title="Java程序"></a>Java程序</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>{</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>{</span><br><span class="line">		<span class="keyword">return</span> (a+b) * (a-b);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] agrc)</span></span>{</span><br><span class="line">		Hello hello = <span class="keyword">new</span> Hello();</span><br><span class="line">		System.out.println(hello.foo(<span class="number">5</span>, <span class="number">3</span>));</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>这个代码很好理解，定义了一个简单的函数并调用了一次。而我们关注的重点在于它经过编译生成后的字节码。</p>
<h4 id="Java字节码的foo-函数部分"><a href="#Java字节码的foo-函数部分" class="headerlink" title="Java字节码的foo()函数部分"></a>Java字节码的foo()函数部分</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public int foo(int, int);</span><br><span class="line">	Code:</span><br><span class="line">	0:	iload_1</span><br><span class="line">	1:	iload_2</span><br><span class="line">	2:	iadd</span><br><span class="line">	3:	iload_1</span><br><span class="line">	4:	iload_2</span><br><span class="line">	5:	isub</span><br><span class="line">	6:	imul</span><br><span class="line">	7:	ireturn</span><br><span class="line">	...</span><br></pre></td></tr></tbody></table></figure></div>

<p>这部分截取了.class文件中foo()函数的部分，想要理解这部分指令的含义，得先了解JVM的工作机制。</p>
<p>对Java程序来说，每个线程在执行时都有一个<strong>PC计数器</strong>和一个<strong>Java栈</strong>。PC计数器和x86架构CPU的IP（EIP）寄存器<strong>作用差不多</strong>，可以类比的理解。不同的在于<strong>PC计数器只对当前方法有效</strong>，Java虚拟机通过它的值来取指令执行。</p>
<p>Java栈和C语言调用函数的栈类似，在JVM中，每调用一个方法，就会分配一个新的栈帧并压入Java栈；每从一个方法返回，则弹出并撤销相应的栈帧。每个栈帧包括<strong>局部变量区</strong>，<strong>求值栈</strong>（JVM规范称作操作数栈），<strong>局部变量区</strong>用于<strong>存储方法的参数和局部变量</strong>，<strong>求值栈</strong>用于<strong>保存求值的中间结果</strong>及调用其它方法的参数等。</p>
<p>对JVM的一些机制稍作了解后，我们来看一下指令，先看第一个<strong>iload_1</strong>。这个指令要分为3部分来看：</p>
<ul>
<li>i：指令前缀，表示操作类型为int</li>
<li>load：表示将局部变量存入Java栈</li>
<li>_1：索引，从0开始计数，表示要操作的是哪个局部变量，这里指第2个</li>
</ul>
<p>拆分完后，就可以理解，iload_1表示使第2个int类型的局部变量入栈。</p>
<a href="/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/class_foo.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/class_foo.png"></a>

<p>参考上图，这是JVM运行上面那段Java字节码时，栈帧的状态，可以看到，此时正准备执行iadd指令，在这之前，先取了第2个和第3个int参数入局部变量区，在执行iadd指令前，又从栈顶弹出两个int类型的值进入求值栈，并准备求它们的和。接下来的部分，也可以根据指令推断，首先在<strong>求和完了后会将结果压入求值栈的栈顶（求值栈用于保存求值的中间结果）</strong>，第4条和第5条指令会再次将两个参数入栈，第6条指令进行求差，并把结果压回栈顶。此时求值栈中已经有两个int类型的值了。第7条指令imul用于从栈顶弹出两个int类型的值并求它们的积，把结果压回栈顶。第8条指令ireturn用于返回一个int类型的值。</p>
<p>这下是弄明白了Java字节码这部分指令的含义，关于更多JVM指令的含义，可以参考<a href="https://blog.csdn.net/hudashi/article/details/7062675" target="_blank" rel="noopener">此篇文章</a>。现在可以看到，Java字节码在执行行，会进行多次的压栈，出栈操作，这样会大量访问内存，耗费大量的CPU时间。所以，才有了Dalvik字节码的诞生。</p>
<h4 id="Dalvik字节码的foo-函数部分"><a href="#Dalvik字节码的foo-函数部分" class="headerlink" title="Dalvik字节码的foo()函数部分"></a>Dalvik字节码的foo()函数部分</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">	Virtual methods			-</span><br><span class="line">	   #0				: (in LHello;)</span><br><span class="line">		name			: 'foo'</span><br><span class="line">		type			: '(II)I'</span><br><span class="line">		access			: 0x0001 (PUBLIC)</span><br><span class="line">		code			-</span><br><span class="line">		registers		: 5</span><br><span class="line">		ins			: 3</span><br><span class="line">		outs			: 0</span><br><span class="line">		insns size		: 6 16-bit code units</span><br><span class="line">000198:							|[000198] Hello.foo:(II)I</span><br><span class="line">0001a8: 9000 0304					|0000: add-int v0, v3, v4</span><br><span class="line">0001ac: 9101 0304					|0002: sub-int v1, v3, v4</span><br><span class="line">0001b0: b210						|0004: mul-int/2addr v0, v1</span><br><span class="line">0001b2: 0f00						|0005: return v0</span><br><span class="line">		catches			: (none)</span><br><span class="line">		positions		: 0x0000 line=3</span><br><span class="line">		locals			: 0x0000 - 0x0006 reg=2 this LHello;</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure></div>

<p>Dalvik字节码这部分看上去很复杂，但实际上，很大一部分都是对函数的描述性的字段（这部分会在下一篇语言基础中讲到）。真正在实现foo()函数上，<strong>Dalvik字节码只使用了4条指令（Java字节码需要8条）</strong>。下面来看看它门的含义。</p>
<p>第1条指令add-int将v3和v4寄存器的值相加，结果存到v0寄存器中；第2条指令sub-int将v3和v4寄存器的值相减，将结果保存到v1寄存器中；第3条指令mul-int/2addr将v0和v1寄存器的值相乘，结果保存到v0寄存器中。第4条指令用于返回v0寄存器的值。</p>
<p><strong>DVM运行时也为每个线程维护了一个PC计数器和一个调用栈</strong>。与JVM不同的是，这个<strong>调用栈维护了一个寄存器列表</strong>，寄存器的数量在方法结构体的registers字段中给出。DVM会根据这个值来创建一份虚拟的寄存器列表。DVM运行时的状态，可以参考下图：</p>
<a href="/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/dalvik_foo.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/dalvik_foo.png"></a>

<p>通过比较JVM和DVM的运行状态以及实现同一功能的指令，可以发现与基于栈架构的JVM相比，基于寄存器架构的DVM生成的代码指令明显减少了，加上原本寄存器较内存更快的访问速度，使得DVM更适合资源有限的设备。</p>
<h2 id="Dalvik虚拟机的执行流程"><a href="#Dalvik虚拟机的执行流程" class="headerlink" title="Dalvik虚拟机的执行流程"></a>Dalvik虚拟机的执行流程</h2><p>Dalvik虚拟机的执行流程很复杂，如果展开讲，仅一个Zygote进程的启动流程，就够写两篇博客了。这里不拓展太多，结合书中内容介绍主体部分，了解个大概，等到一周目通关后，可再去研究Android进程启动等细节。</p>
<p>在了解虚拟机执行流程前，先来看张图，这是一张经典的Android系统组成的图。</p>
<a href="/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/androidsystem.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/androidsystem.png"></a>

<p>通过这张图我们可以看到两点：<strong>Android系统基于Linux内核</strong>；<strong>DVM属于Android运行时环境</strong>，它与一些核心库一起承担了Android应用程序的运行工作。</p>
<p>Android系统启动并加载内核后，会立即执行init进程（<strong>Linux系统中，所有进程都是init进程的子孙进程，均由init进程fork出来，包括Zygote</strong>）。init进程先完成设备的初始化工作，再读取init.re文件并启动系统中的重要外部程序Zygote。</p>
<p>Zygote是Android系统中所有进程的孵化器进程。Zygote启动后，会先初始化Dalvik虚拟机（<strong>在AndroidRuntime的start函数中调用startVM启动虚拟机</strong>），再启动<strong>system_server进程（system_server进程负责启动系统的关键服务，如包管理服务PackageManagerService和应用程序组件管理服务ActivityManagerService）</strong>并进入Zygote模式，通过socket等候命令的下达（<strong>ZygoteInit的main函数中会调用runSelectLoopMode函数进入一个无限循环，在创建的socket接口等待ActivityManagerService发送的创建新的应用程序进程的请求</strong>）。这里提到的<strong>关于Zygote启动过程</strong>的细节，可以参考罗老师的<a href="https://blog.csdn.net/luoshengyang/article/details/6768304" target="_blank" rel="noopener">Android系统进程Zygote启动过程的源代码分析</a>，文章中讲的非常详细。也可以参考另一篇<a href="https://www.jianshu.com/p/ab9b83a77af6" target="_blank" rel="noopener">LooperJing的文章</a>。建议安卓逆向一周目通关后把这两篇都看了。</p>
<p>在执行一个Android应用程序时，system_server进程通过Binder IPC方式将命令发送给Zygote（<strong>此时socket处已在等候命令</strong>），Zygote收到命令后，通过fork其自身创建一个Dalvik虚拟机的实例来执行应用程序的入口函数，从而完成应用程序的启动过程。过程可参考下图。详细细节可以参考罗老师的<a href="https://blog.csdn.net/Luoshengyang/article/details/6747696" target="_blank" rel="noopener">这篇文章</a>。</p>
<a href="/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/appRun.png" data-fancybox="group" data-caption="undefined" class="fancybox"><img class="lazyload" data-src="/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/appRun.png"></a>

<p>Zygote提供了三种创建进程的方法：</p>
<ul>
<li>fork()：创建一个Zygote进程。</li>
<li>forkAndSpecialize()：创建一个非Zygote进程。</li>
<li>forkSystemServer()：创建一个系统服务进程。</li>
</ul>
<p>Zygote进程可以再分成其它进程，非Zygote进程则不能再分成其它进程。系统服务进程终止后，其子进程也必须终止。</p>
<p>进程fork成功后，执行工作将交给DVM完成。DVM先通过loadClassFromDex()函数来装载类。每个类被成功解析后，都会获得<strong>运行时环境（DVM所属位置）</strong>中的一个ClassObject类型的数据结构存储（<strong>虚拟机使用gDvm.loadedClasses全局散列表来存储和查询所有装载进来的类</strong>）。接下来，字节码验证器使用dvmVerifyCodeFlow()函数对装入的代码进行校验，虚拟机调用FindClass()函数查找并装载main()方法类。最后，虚拟机调用dvmInterpret()函数来初始化解释器并执行字节码流。</p>
<p>以上就是DVM的执行流程，这里仅作了解即可，等一周目后再来仔细研究。</p>
<h2 id="Dalvik虚拟机的执行方式"><a href="#Dalvik虚拟机的执行方式" class="headerlink" title="Dalvik虚拟机的执行方式"></a>Dalvik虚拟机的执行方式</h2><p>即时编译（Just-in-time Compilation，JIT），又称动态编译，是一种通过在运行时将字节码翻译为机器码使得程序执行速度加快的技术。主流的JIT包括两种字节码编译方式：</p>
<ul>
<li>method方式：以函数或方法为单位进行编译。</li>
<li>trace方式：以trace为单位进行编译（trace方式即按照执行路径编译，比起method方式编译整个方法，trace更节省时间和内存）。</li>
</ul>
<p>DVM默认采用trace方式编译，同时支持method方式。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><strong>参考书籍：</strong>《Android软件安全权威指南》—— 丰生强</p>
<p><strong>参考链接：</strong></p>
<ol>
<li><a href="https://www.jianshu.com/p/6bdbbab73705" target="_blank" rel="noopener">https://www.jianshu.com/p/6bdbbab73705</a> （简书文章-关于Dalvik虚拟机）</li>
<li><a href="https://blog.csdn.net/cy524563/article/details/41550915" target="_blank" rel="noopener">https://blog.csdn.net/cy524563/article/details/41550915</a> （CSDN文章-什么是Dalvik虚拟机）</li>
<li><a href="https://stackoverflow.com/questions/33533370/difference-between-aar-jar-dex-apk-in-android" target="_blank" rel="noopener">https://stackoverflow.com/questions/33533370/difference-between-aar-jar-dex-apk-in-android</a> （stackoverflow解答-jar,dex,apk,aar的区别）</li>
<li><a href="https://juejin.im/post/5bf22bb5e51d454cdc56cbd5" target="_blank" rel="noopener">https://juejin.im/post/5bf22bb5e51d454cdc56cbd5</a> （掘金文章-浅谈Android Dex文件）</li>
<li><a href="https://blog.csdn.net/zzc901205/article/details/77676330" target="_blank" rel="noopener">https://blog.csdn.net/zzc901205/article/details/77676330</a> （CSDN文章-java,class,dex转换过程）</li>
<li><a href="https://blog.csdn.net/hudashi/article/details/7062675" target="_blank" rel="noopener">https://blog.csdn.net/hudashi/article/details/7062675</a> （CSDN文章-JVM指令详解(上)）</li>
<li><a href="https://www.jianshu.com/p/ab9b83a77af6" target="_blank" rel="noopener">https://www.jianshu.com/p/ab9b83a77af6</a> （简书文章-Zygote进程的启动流程）</li>
<li><a href="https://blog.csdn.net/luoshengyang/article/details/6768304" target="_blank" rel="noopener">https://blog.csdn.net/luoshengyang/article/details/6768304</a> （CSDN文章-Zygote启动过程的源代码分析）</li>
<li><a href="https://blog.csdn.net/Luoshengyang/article/details/6747696" target="_blank" rel="noopener">https://blog.csdn.net/Luoshengyang/article/details/6747696</a> （CSDN文章-Android应用程序进程启动过程的源代码分析）</li>
</ol>
</body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">cataLoc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://cataloc.gitee.io/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/">http://cataloc.gitee.io/blog/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/blog/tags/Android%E9%80%86%E5%90%91/">Android逆向    </a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/cataloc/blog/raw/master/2020/06/09/Dalvik%E8%99%9A%E6%8B%9F%E6%9C%BA/cover0xB.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/blog/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/blog/img/alipay.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/blog/2020/06/15/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%8003-%E4%B8%8A-%E6%89%B9%E5%A4%84%E7%90%86%E4%B8%8E%E7%97%85%E6%AF%92/"><img class="prev_cover lazyload" data-src="https://gitee.com/cataloc/blog/raw/master/2020/06/15/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%8003-%E4%B8%8A-%E6%89%B9%E5%A4%84%E7%90%86%E4%B8%8E%E7%97%85%E6%AF%92/cover0xC.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Previous Post</div><div class="prev_info"><span>网络安全基础03(上)：批处理与病毒</span></div></a></div><div class="next-post pull_right"><a href="/blog/2020/06/04/%E5%A4%87%E7%94%A8APC%E9%98%9F%E5%88%97/"><img class="next_cover lazyload" data-src="https://gitee.com/cataloc/blog/raw/master/2020/06/04/%E5%A4%87%E7%94%A8APC%E9%98%9F%E5%88%97/cover0xA.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>备用APC队列</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/blog/2020/05/03/Android程序分析入门-上/" title="Android程序分析入门（准备工作）"><img class="relatedPosts_cover lazyload"data-src="https://gitee.com/cataloc/blog/raw/master/2020/05/03/Android%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E5%85%A5%E9%97%A8-%E4%B8%8A/cover0x01.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-03</div><div class="relatedPosts_title">Android程序分析入门（准备工作）</div></div></a></div><div class="relatedPosts_item"><a href="/blog/2020/05/11/frida安装（Windows）/" title="Frida简要安装教程（Windows）"><img class="relatedPosts_cover lazyload"data-src="https://gitee.com/cataloc/blog/raw/master/2020/05/11/frida%E5%AE%89%E8%A3%85%EF%BC%88Windows%EF%BC%89/cover0x04.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-11</div><div class="relatedPosts_title">Frida简要安装教程（Windows）</div></div></a></div><div class="relatedPosts_item"><a href="/blog/2020/05/11/Android程序分析入门-下/" title="Android程序分析入门（破解程序）"><img class="relatedPosts_cover lazyload"data-src="https://gitee.com/cataloc/blog/raw/master/2020/05/11/Android%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E5%85%A5%E9%97%A8-%E4%B8%8B/Cover0x05.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-11</div><div class="relatedPosts_title">Android程序分析入门（破解程序）</div></div></a></div><div class="relatedPosts_item"><a href="/blog/2020/07/24/Dalvik指令集/" title="Dalvik指令集"><img class="relatedPosts_cover lazyload"data-src="https://gitee.com/cataloc/blog/raw/master/2020/07/24/Dalvik%E6%8C%87%E4%BB%A4%E9%9B%86/cover0x10.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-24</div><div class="relatedPosts_title">Dalvik指令集</div></div></a></div><div class="relatedPosts_item"><a href="/blog/2020/08/06/adb与Root/" title="adb&Root"><img class="relatedPosts_cover lazyload"data-src="https://gitee.com/cataloc/blog/raw/master/2020/08/06/adb%E4%B8%8ERoot/cover0x11.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-08-06</div><div class="relatedPosts_title">adb&Root</div></div></a></div><div class="relatedPosts_item"><a href="/blog/2020/08/09/常见Android文件格式1/" title="Android文件格式：库文件"><img class="relatedPosts_cover lazyload"data-src="https://gitee.com/cataloc/blog/raw/master/2020/08/09/%E5%B8%B8%E8%A7%81Android%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F1/cover0x14.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-08-09</div><div class="relatedPosts_title">Android文件格式：库文件</div></div></a></div></div><div class="clear_both"></div></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By cataLoc</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/main.js"></script><script src="/blog/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>